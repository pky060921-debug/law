{% extends "layout.html" %}
{% block content %}
<h1>
    {% if mode == 'acquire' %}ğŸ“¥ íšë“ êµ¬ì—­
    {% elif mode == 'review' %}ğŸ”„ ë³µìŠµ êµ¬ì—­
    {% else %}âš¡ ì•½ì–´ êµ¬ì—­{% endif %}
</h1>
<p style="text-align:center; color:#aaa;">
    {% if mode == 'acquire' %}ì•„ì§ ë°°ìš°ì§€ ì•Šì€ ì¹´ë“œë“¤ì…ë‹ˆë‹¤.{% elif mode == 'review' %}ë°˜ë³µí• ìˆ˜ë¡ ì¹´ë“œê°€ ê°•ë ¥í•´ì§‘ë‹ˆë‹¤.{% else %}ì²« ê¸€ìë¥¼ ë³´ê³  ì „ì²´ë¥¼ ë§ì¶”ì„¸ìš”!{% endif %}
</p>

<div style="margin-top:20px;">
    {% if not quests %}
        <div style="text-align:center; padding:50px; color:#7f8c8d;">
            í•™ìŠµí•  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.<br>
            (ì´ì „ ë‹¨ê³„ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”)
        </div>
    {% endif %}

    {% set groups = {} %}
    {% for q in quests %}
        {% set title = q.quest_name.split('-')[0] %}
        {% if title not in groups %}{% set _ = groups.update({title: []}) %}{% endif %}
        {% set _ = groups[title].append(q) %}
    {% endfor %}

    {% for title, items in groups.items() %}
    <details style="margin-bottom:15px; background:#34495e; border-radius:10px; overflow:hidden;" open>
        <summary style="padding:15px; cursor:pointer; font-weight:bold; color:#f39c12; list-style:none;">
            ğŸ“‚ {{ title }} <span style="color:#bdc3c7; font-size:0.8em;">({{ items|length }}ê°œ)</span>
        </summary>
        <div style="background:#2c3e50; padding:10px;">
            {% for item in items %}
            <form method="POST" style="margin-bottom:5px;">
                <input type="hidden" name="quest_name" value="{{ item.quest_name }}">
                <input type="hidden" name="quest_type" value="{{ item.type }}"> 
                
                <button type="submit" style="width:100%; text-align:left; background:transparent; border:none; color:#ecf0f1; padding:12px; border-bottom:1px solid #444; cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
                    <span>
                        {% if item.type == 'ABBREV' %}
                            <span style="background:#9b59b6; color:white; padding:2px 6px; border-radius:4px; font-size:0.8rem; margin-right:5px;">ì•½ì–´</span>
                        {% else %}
                            <span style="background:#3498db; color:white; padding:2px 6px; border-radius:4px; font-size:0.8rem; margin-right:5px;">ë¹ˆì¹¸</span>
                        {% endif %}
                        {{ item.quest_name.split('-')[-1] }}
                    </span>
                    
                    {% if mode != 'acquire' %}
                        <span style="color:#2ecc71; font-weight:bold;">Lv.{{ item.level }}</span>
                    {% endif %}
                </button>
            </form>
            {% endfor %}
        </div>
    </details>
    {% endfor %}
</div>
{% endblock %}
