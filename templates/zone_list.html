{% extends "layout.html" %}

{% block content %}

{% macro card_button(item, mode) %}
<form method="POST" style="margin:0;">
    <input type="hidden" name="quest_name" value="{{ item.get('quest_name') }}">
    <input type="hidden" name="quest_type" value="{{ item.get('type') }}"> 
    
    <button type="submit" class="card-item" style="width:100%; text-align:left; color:#ecf0f1; display:block;">
        <div style="font-weight:bold; font-size:0.95rem; margin-bottom:5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
            {{ item.get('quest_name', '').split('-')[-1] }}
        </div>
        
        <div style="display:flex; justify-content:space-between; align-items:center; font-size:0.8rem; color:#bdc3c7;">
            <span>
                {% if mode == 'acquire' %}ğŸ“¥ íšë“í•˜ê¸°
                {% else %}â–¶ï¸ ì‹œì‘{% endif %}
            </span>
            
            {% if mode != 'acquire' %}
                {% set lv = item.get('level', 1)|int %}
                <span class="level-badge {% if lv < 5 %}lv-low{% elif lv < 10 %}lv-mid{% else %}lv-high{% endif %}">
                    Lv.{{ lv }}
                </span>
            {% endif %}
        </div>
    </button>
</form>
{% endmacro %}


<style>
    /* 3ë‹¨ ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ (ê³µí†µ) */
    .law-board {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15px;
        margin-top: 10px;
    }
    
    .law-column {
        background: #253342;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #34495e;
    }

    .law-column h4 {
        text-align: center;
        margin: 0 0 10px 0;
        padding-bottom: 5px;
        border-bottom: 2px solid #555;
        font-size: 1rem;
    }

    /* ìƒ‰ìƒ êµ¬ë¶„ */
    .col-law h4 { color: #3498db; border-color: #3498db; }
    .col-decree h4 { color: #e67e22; border-color: #e67e22; }
    .col-rule h4 { color: #2ecc71; border-color: #2ecc71; }

    .card-item {
        background: #34495e;
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 5px;
        border: 1px solid #444;
        transition: 0.2s;
        cursor: pointer;
    }
    .card-item:hover { border-color: #f39c12; transform: translateY(-2px); }

    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 768px) {
        .law-board { grid-template-columns: 1fr; }
        .law-column { margin-bottom: 15px; }
    }
    
    .level-badge {
        font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; float: right;
    }
    .lv-low { background: #2ecc71; color: #fff; }
    .lv-mid { background: #f39c12; color: #fff; }
    .lv-high { background: #e74c3c; color: #fff; }
</style>

<h1>
    {% if mode == 'acquire' %}ğŸ“¥ íšë“ êµ¬ì—­
    {% elif mode == 'review' %}ğŸ”„ ë³µìŠµ êµ¬ì—­
    {% else %}âš¡ ì•½ì–´ í›ˆë ¨ì†Œ{% endif %}
</h1>
<p style="text-align:center; color:#aaa; margin-bottom:20px;">
    {% if mode == 'acquire' %}ìƒˆë¡œìš´ ì§€ì‹ì„ ë‚´ ê²ƒìœ¼ë¡œ ë§Œë“œì„¸ìš”.{% elif mode == 'review' %}ë°˜ë³µí• ìˆ˜ë¡ ê¸°ì–µì€ ê°•ë ¥í•´ì§‘ë‹ˆë‹¤.{% else %}ë‘ë¬¸ì(ì•½ì–´)ë¥¼ ì™„ë²½í•˜ê²Œ ì•”ê¸°í•˜ì„¸ìš”.{% endif %}
</p>

{% if not quests %}
    <div style="text-align:center; padding:50px; color:#7f8c8d; border: 2px dashed #555; border-radius: 10px;">
        í•™ìŠµí•  ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.<br>
        (ì´ì „ ë‹¨ê³„ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”)
    </div>
{% else %}

    {% set laws = [] %}{% set decrees = [] %}{% set rules = [] %}{% set others = [] %}
    
    {% for item in quests %}
        {% if item.get('quest_name').startswith('ì œ-') %}
            {% set _ = laws.append(item) %}
        {% elif item.get('quest_name').startswith('ë ¹-') %}
            {% set _ = decrees.append(item) %}
        {% elif item.get('quest_name').startswith('ê·œ-') %}
            {% set _ = rules.append(item) %}
        {% else %}
            {% set _ = others.append(item) %}
        {% endif %}
    {% endfor %}

    <div class="law-board">
        <div class="law-column col-law">
            <h4>âš–ï¸ ë²•ë¥  ({{ laws|length }})</h4>
            {% for item in laws %}
                {{ card_button(item, mode) }}
            {% endfor %}
        </div>

        <div class="law-column col-decree">
            <h4>ğŸ“œ ì‹œí–‰ë ¹ ({{ decrees|length }})</h4>
            {% for item in decrees %}
                {{ card_button(item, mode) }}
            {% endfor %}
        </div>

        <div class="law-column col-rule">
            <h4>ğŸ“ ì‹œí–‰ê·œì¹™ ({{ rules|length }})</h4>
            {% for item in rules %}
                {{ card_button(item, mode) }}
            {% endfor %}
        </div>
    </div>

    {% if others %}
    <div style="margin-top:20px; border-top:1px dashed #555; padding-top:15px;">
        <h4 style="color:#bdc3c7; text-align:center;">ğŸ“‚ ê¸°íƒ€ ë¬¸ì„œ</h4>
        <div class="law-board">
            <div class="law-column" style="grid-column: 1 / -1; background:#2c3e50;">
                {% for item in others %}
                    {{ card_button(item, mode) }}
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

{% endif %}

{% endblock %}
