<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”Œë ˆì´</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #1a1a1a; color: #fff; text-align: center; padding: 20px; }
        .game-container { 
            max-width: 800px; margin: 0 auto; background: #2a2a2a; padding: 30px; 
            border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.5); line-height: 2.2; 
        }
        .sentence-box { font-size: 1.2rem; text-align: left; word-break: keep-all; }
        
        /* í¸ì§‘ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        .word-token { cursor: pointer; padding: 2px 5px; margin: 2px; border-radius: 4px; transition: 0.2s; display: inline-block; }
        .word-token:hover { background-color: #444; }
        .word-token.selected { background-color: #ff6b6b; color: white; font-weight: bold; }
        
        /* í”Œë ˆì´ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        input { background: transparent; border: none; border-bottom: 2px solid #ffd700; color: #ffd700; text-align: center; font-size: 1.1rem; width: 80px; margin: 0 5px; }
        input:focus { outline: none; border-bottom: 2px solid #fff; }
        
        .btn { display: inline-block; width: 100%; padding: 15px; margin-top: 20px; background: #ffd700; color: #000; border: none; border-radius: 5px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        .flash { color: #ff6b6b; margin-bottom: 15px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ“œ ì£¼ë¬¸ì„œ í•´ë…</h1>
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="flash">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="game-container">
        
        {% if edit_mode %}
            <h3 style="color: #4a90e2;">ğŸ‘† 1íšŒì°¨: ë¹ˆì¹¸ìœ¼ë¡œ ë§Œë“¤ ë‹¨ì–´ë¥¼ í„°ì¹˜í•˜ì„¸ìš”!</h3>
            <div class="sentence-box" id="editor-area">
                {% for word in words %}
                    <span class="word-token" onclick="toggleWord(this)">{{ word }}</span>
                {% endfor %}
            </div>
            
            <form method="POST" onsubmit="saveEditor()">
                <input type="hidden" name="edited_content" id="hidden_content">
                <button type="submit" class="btn" style="background: #4a90e2; color: white;">ì €ì¥í•˜ê³  ì•”ê¸° ì‹œì‘</button>
            </form>

            <script>
                function toggleWord(el) {
                    el.classList.toggle('selected');
                }
                function saveEditor() {
                    const tokens = document.querySelectorAll('.word-token');
                    let result = [];
                    tokens.forEach(t => {
                        if (t.classList.contains('selected')) {
                            result.push("{" + t.innerText + "}");
                        } else {
                            result.push(t.innerText);
                        }
                    });
                    // ê³µë°±ìœ¼ë¡œ ë‹¤ì‹œ í•©ì³ì„œ ì „ì†¡
                    document.getElementById('hidden_content').value = result.join(" ");
                }
            </script>

        {% else %}
            <form method="POST" autocomplete="off">
                <div class="sentence-box">
                    {% for part in parts %}
                        {% if part.type == 'text' %}
                            <span>{{ part.val }}</span>
                        {% else %}
                            <input type="text" name="answers" required placeholder="?">
                        {% endif %}
                    {% endfor %}
                </div>
                
                {% if has_blanks %}
                    <button type="submit" class="btn">í•´ë… í™•ì¸</button>
                {% else %}
                    <button type="submit" class="btn">ì™„ë£Œ (ë‹¤ìŒìœ¼ë¡œ)</button>
                {% endif %}
                
                <a href="{{ url_for('dungeon') }}" style="display:block; margin-top:15px; color:#888; font-size:0.9rem;">ë‚˜ê°€ê¸°</a>
            </form>
        {% endif %}
        
    </div>
</body>
</html>
