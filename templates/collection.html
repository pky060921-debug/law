{% extends "layout.html" %}

{% block content %}
<style>
    /* ì¹´ë“œ ê·¸ë¦¬ë“œ ë°˜ì‘í˜• */
    .card-grid {
        display: grid;
        /* í™”ë©´ í¬ê¸°ì— ë”°ë¼ ì—´ ê°œìˆ˜ ìë™ ì¡°ì ˆ */
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 15px;
        margin-top: 30px;
    }
    
    .card {
        background: #ecf0f1; color: #2c3e50; border-radius: 10px; padding: 15px;
        text-align: center; position: relative; border-bottom: 4px solid #bdc3c7;
        transition: transform 0.2s;
    }
    .card:hover { transform: translateY(-5px); }

    .card.NORMAL { border-top: 4px solid #95a5a6; }
    .card.RARE { border-top: 4px solid #3498db; background: #eaf2f8; }
    .card.LEGEND { border-top: 4px solid #f1c40f; background: #fcf3cf; }

    .grade-badge {
        font-size: 0.8rem; font-weight: bold; padding: 2px 8px; border-radius: 10px;
        display: inline-block; margin-bottom: 5px; color: white;
    }
    .NORMAL .grade-badge { background: #95a5a6; }
    .RARE .grade-badge { background: #3498db; }
    .LEGEND .grade-badge { background: #f1c40f; color: #333; }

    .btn-exchange {
        width: 100%; margin-top: 10px; padding: 8px; border: none; border-radius: 5px;
        background: #e67e22; color: white; font-family: 'Do Hyeon'; cursor: pointer;
    }

    .my-points { text-align: right; font-size: 1.2rem; color: #f1c40f; margin-bottom: 10px; }

    /* ğŸ“± ëª¨ë°”ì¼ */
    @media (max-width: 768px) {
        .card-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .card { padding: 10px; }
        .my-points { font-size: 1rem; }
    }
</style>

<h1>ğŸƒ ì¹´ë“œ ë„ê°</h1>
<div class="my-points">ë‚´ ì§€ê°‘: <span id="current-points">{{ points }}</span> P</div>

{% if cards %}
<div class="card-grid">
    {% for card in cards %}
    <div class="card {{ card.grade }}" id="card-{{ loop.index }}">
        <span class="grade-badge">{{ card.grade }}</span>
        <div style="font-size: 1rem; font-weight: bold; margin: 10px 0; min-height: 40px; display:flex; align-items:center; justify-content:center;">
            {{ card.card_text }}
        </div>
        <div style="color: #7f8c8d; font-size: 0.8rem;">
            ë³´ìœ : <b id="count-{{ loop.index }}">{{ card.count }}</b>ì¥
        </div>
        <button class="btn-exchange" onclick="exchangeCard('{{ card.card_text }}', {{ loop.index }})">ğŸ’° êµí™˜</button>
    </div>
    {% endfor %}
</div>
{% else %}
<div style="text-align:center; padding:50px; color:#95a5a6;">íšë“í•œ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
{% endif %}

<script>
    function exchangeCard(cardText, index) {
        if(!confirm(`'${cardText}' ì¹´ë“œë¥¼ í¬ì¸íŠ¸ë¡œ êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        fetch('/exchange', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ card_text: cardText })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`+${data.earned} P íšë“!`);
                document.getElementById('current-points').innerText = data.new_total;
                const countEl = document.getElementById(`count-${index}`);
                let cnt = parseInt(countEl.innerText) - 1;
                if (cnt <= 0) document.getElementById(`card-${index}`).remove();
                else countEl.innerText = cnt;
            } else { alert('ì‹¤íŒ¨: ' + data.msg); }
        });
    }
</script>
{% endblock %}
